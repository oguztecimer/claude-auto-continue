---
phase: 04-cli-packaging-and-distribution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - bin/claude-auto-continue.js
  - src/cli.ts
autonomous: true
requirements: [INFR-03]

must_haves:
  truths:
    - "Running `npx claude-auto-continue --help` prints usage instructions and exits with code 0"
    - "Running `npx claude-auto-continue --version` prints the version from package.json and exits with code 0"
    - "Running `npx claude-auto-continue` (no flags) starts the tool the same way as `npx tsx src/cli.ts`"
    - "The bin wrapper at bin/claude-auto-continue.js has a shebang and requires ../dist/cli.js"
    - "package.json has bin field mapping claude-auto-continue and cac to the bin wrapper"
    - "package.json has files field limiting published content to dist/ and bin/"
    - "`npm run build` compiles TypeScript to dist/ without errors"
  artifacts:
    - bin/claude-auto-continue.js
    - dist/cli.js (after build)
    - package.json (modified with bin, files, engines, prepublishOnly)
  key_links:
    - bin/claude-auto-continue.js requires ../dist/cli.js
    - package.json bin field points to bin/claude-auto-continue.js
    - src/cli.ts handles --help and --version before spawning ProcessSupervisor
---

<objective>
Package the tool as an installable npm CLI command with help output and a short alias.

Purpose: This is the final phase. The tool works locally via `npx tsx src/cli.ts`. This plan adds npm packaging so users can `npm install -g claude-auto-continue` and run `claude-auto-continue` or `cac` directly. It also adds `--help` and `--version` flags for discoverability.

Output: Modified `package.json` with bin/files/engines fields, new `bin/` wrapper script, updated `src/cli.ts` with help/version handling. After `npm run build && npm install -g .`, the CLI works globally.
</objective>

<execution_context>
@/Users/dakmor/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dakmor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-cli-packaging-and-distribution/04-RESEARCH.md

<interfaces>
From src/cli.ts (current entry point):
```typescript
import { ProcessSupervisor } from './ProcessSupervisor.js';
import { StatusBar } from './StatusBar.js';
import { CountdownCard } from './CountdownCard.js';
import type { StateChangeEvent } from './ProcessSupervisor.js';

function parseArgs(argv: string[]): { claudeArgs: string[] }
function main(): void
```

From package.json (current):
```json
{
  "name": "claude-auto-continue",
  "version": "0.1.0",
  "main": "dist/index.js",
  "scripts": {
    "test": "vitest run",
    "test:watch": "vitest",
    "build": "tsc"
  }
}
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add --help and --version flag handling to cli.ts</name>
  <files>src/cli.ts</files>
  <action>
Modify `src/cli.ts` to handle `--help`/`-h` and `--version`/`-v` flags BEFORE the existing `main()` logic. These flags should print output and exit immediately without spawning ProcessSupervisor.

**Add at the top of cli.ts (after imports):**

```typescript
import { readFileSync } from 'fs';
import { join } from 'path';
```

**Add a `getVersion()` helper:**
```typescript
function getVersion(): string {
  try {
    const pkgPath = join(__dirname, '..', 'package.json');
    const pkg = JSON.parse(readFileSync(pkgPath, 'utf8'));
    return pkg.version ?? 'unknown';
  } catch {
    return 'unknown';
  }
}
```

Note: `__dirname` works correctly in CommonJS (which this project uses).

**Add `showHelp()` function:**
```typescript
function showHelp(): void {
  const version = getVersion();
  console.log(`claude-auto-continue v${version}

Automatically resumes Claude Code sessions after usage limits reset.

USAGE:
  claude-auto-continue [options] [-- claude-code-args...]
  cac [options] [-- claude-code-args...]

OPTIONS:
  --help, -h       Show this help message
  --version, -v    Show version number

EXAMPLES:
  claude-auto-continue                  Start with defaults
  claude-auto-continue -- --continue    Pass --continue to Claude Code
  cac -- --resume                       Short alias, pass --resume to Claude Code

WHAT IT DOES:
  Wraps Claude Code in a PTY, monitors for rate-limit messages, waits
  until the reset time, then sends "continue" to resume automatically.
  A status bar and countdown timer show progress while waiting.`);
}
```

**Modify the argument handling at the start of `main()` — add early exit logic BEFORE the existing parseArgs call:**

```typescript
function main(): void {
  const args = process.argv.slice(2);

  // Handle --help and --version before anything else
  if (args.includes('--help') || args.includes('-h')) {
    showHelp();
    process.exit(0);
  }
  if (args.includes('--version') || args.includes('-v')) {
    console.log(getVersion());
    process.exit(0);
  }

  // Existing parseArgs and main logic continues unchanged...
  const { claudeArgs } = parseArgs(process.argv);
  // ... rest of main()
}
```

**Important:** Do NOT change any of the existing ProcessSupervisor/StatusBar/CountdownCard wiring logic. Only add the early-exit help/version handling at the top of `main()`.
  </action>
  <verify>
    <automated>npx tsx src/cli.ts --help && npx tsx src/cli.ts --version</automated>
  </verify>
  <done>`npx tsx src/cli.ts --help` prints usage text and exits 0. `npx tsx src/cli.ts --version` prints "0.1.0" and exits 0. `npx tsx src/cli.ts -h` and `npx tsx src/cli.ts -v` work as aliases.</done>
</task>

<task type="auto">
  <name>Task 2: Create bin wrapper, update package.json, build and verify</name>
  <files>bin/claude-auto-continue.js, package.json</files>
  <action>
**Step 1: Create `bin/claude-auto-continue.js`** (the shebang wrapper):

```javascript
#!/usr/bin/env node
require('../dist/cli.js');
```

Make it executable: `chmod +x bin/claude-auto-continue.js`

This is the standard npm bin wrapper pattern. The shebang tells the OS to use Node.js. The require loads the compiled TypeScript output.

**Step 2: Update `package.json`** — add these fields:

```json
{
  "bin": {
    "claude-auto-continue": "bin/claude-auto-continue.js",
    "cac": "bin/claude-auto-continue.js"
  },
  "files": [
    "dist/",
    "bin/"
  ],
  "engines": {
    "node": ">=18"
  }
}
```

Also add `prepublishOnly` script:
```json
{
  "scripts": {
    "test": "vitest run",
    "test:watch": "vitest",
    "build": "tsc",
    "prepublishOnly": "npm run build"
  }
}
```

**The `bin` field** maps two command names to the same wrapper:
- `claude-auto-continue` — full name
- `cac` — short alias (Claude Auto Continue)

**The `files` field** limits what gets published to npm (excludes src/, test/, .planning/).

**The `engines` field** sets minimum Node.js version (node-pty requires >=18, project uses ES2022).

**The `prepublishOnly` script** ensures TypeScript is compiled before `npm publish`.

**Step 3: Build and verify:**

1. Run `npm run build` — should compile TypeScript to dist/ without errors
2. Verify `dist/cli.js` exists
3. Run `node bin/claude-auto-continue.js --help` — should print usage and exit 0
4. Run `node bin/claude-auto-continue.js --version` — should print version and exit 0
5. Run existing tests: `npx vitest run` — all should pass (no source logic changed for tested modules)
  </action>
  <verify>
    <automated>npm run build && node bin/claude-auto-continue.js --help && node bin/claude-auto-continue.js --version && npx vitest run</automated>
  </verify>
  <done>TypeScript compiles to dist/ without errors. `node bin/claude-auto-continue.js --help` prints usage. `node bin/claude-auto-continue.js --version` prints version. All existing tests pass. package.json has bin, files, engines, and prepublishOnly fields.</done>
</task>

</tasks>

<verification>
- `npm run build` — TypeScript compiles to dist/ without errors
- `node bin/claude-auto-continue.js --help` — prints usage text and exits 0
- `node bin/claude-auto-continue.js --version` — prints "0.1.0" and exits 0
- `npx vitest run` — all existing tests pass
- `cat package.json | grep -A2 '"bin"'` — shows claude-auto-continue and cac entries
- `cat package.json | grep -A2 '"files"'` — shows dist/ and bin/
- `cat package.json | grep -A1 '"engines"'` — shows node >=18
- `ls bin/claude-auto-continue.js` — file exists and has shebang
- `head -1 bin/claude-auto-continue.js` — shows `#!/usr/bin/env node`
</verification>

<success_criteria>
- package.json has bin field mapping both `claude-auto-continue` and `cac` to bin wrapper
- package.json has files field with dist/ and bin/
- package.json has engines.node >= 18
- package.json has prepublishOnly script that runs build
- bin/claude-auto-continue.js exists with shebang and requires ../dist/cli.js
- src/cli.ts handles --help/-h (prints usage, exits 0)
- src/cli.ts handles --version/-v (prints version, exits 0)
- `npm run build` succeeds (TypeScript compiles to dist/)
- `node bin/claude-auto-continue.js --help` prints usage
- All existing tests pass unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/04-cli-packaging-and-distribution/04-01-SUMMARY.md`
</output>
